<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Species distribution model selection • SDMSelect</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Species distribution model selection">
<meta property="og:description" content="SDMSelect">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SDMSelect</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Covar_Selection.html">Select the best covariates to fit a model</a>
    </li>
    <li>
      <a href="../articles/SDM_Selection.html">Species distribution model selection</a>
    </li>
    <li>
      <a href="../articles/TODO.html">To do list for dev</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/statnmap/SDMSelect/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SDM_Selection_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Species distribution model selection</h1>
                        <h4 class="author">StatnMap - Sébastien Rochette</h4>
            
            <h4 class="date">2021-03-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/statnmap/SDMSelect/blob/master/vignettes/SDM_Selection.Rmd"><code>vignettes/SDM_Selection.Rmd</code></a></small>
      <div class="hidden name"><code>SDM_Selection.Rmd</code></div>

    </div>

    
    
<div id="outlines" class="section level2">
<h2 class="hasAnchor">
<a href="#outlines" class="anchor"></a>Outlines</h2>
<p>This library has been created for model selection to predict species distributions (Biomass, density or presence/absence). Its final aim is to produce maps of predicted distributions.<br>
In this vignette, we use datasets from library <code>dismo</code> to show the different possibilities of the library with species distribution modelling, from model selection to predictive mapping. Dataset <code>bradypus</code> contains geographic position of species occurence. The different model types available in library <code>ModelSelect</code> to predict probability of presence all rely on presence/absence data. As the dataset only contains presence data, we need to create a pseudo-absence set of observations. Here, we do not discuss this method. We just imagine that we have a dataset of real observations of presence and <strong>real observations of absences</strong>, so that we can use presence-absence models.<br>
We create a variable of interest (<code>Obs</code>) with presences (<code>1</code>) and absences (<code>0</code>). This is in accordance with our data modelling case <code>datatype = "PA"</code> and its sub-cases. For other types of data, refer to the documentation (in particular, options in <code>modelselect_opt</code>) to correctly set your modelling parameters.<br>
*Note that most figures of the vignette are saved in “inst” so that model selection is not run during vignette building. However, code in the vignettes can be run on your own computer and should return the same outputs. To do so, open and run this Rmd file: /Users/runner/work/_temp/Library/SDMSelect/SDM_Selection/SDM_Selection.Rmd.*</p>
</div>
<div id="load-libraries-and-other-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#load-libraries-and-other-setup" class="anchor"></a>Load libraries and other setup</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/statnmap/SDMSelect">SDMSelect</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster/sdm/">dismo</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>
<span class="co"># Temp directory for saving all outputs</span>
<span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/out_SDM"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">tmpdir</span><span class="op">)</span></code></pre></div>
</div>
<div id="covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#covariates" class="anchor"></a>Covariates</h2>
<p>Covariates are environmental covariates that will be used to predict distribution of the species. In this vignette, we use raster already prepared from package <code>dismo</code>. This means that all rasters have the same projection, extent and resolution and can be stacked into a multi-layer Raster. In this case, they can directly be stacked together. If this is not your case, you can use function <code>Prepare_r_multi</code> to reproject, resample, crop all rasters of covariates to the dimensions of a reference raster (if needed). You only need to provide a vector of all paths to these rasters. Rasters representing factors / categories (like <code>biome.grd</code> here), should be resampled using nearest neighbour method (if they need to be resampled), thus they have to be declared with <code>is.factor</code> option.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># World map for plots</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">wrld_simpl</span>, package <span class="op">=</span> <span class="st">"maptools"</span><span class="op">)</span>

<span class="co"># Vectors of paths to rasters of covariates</span>
<span class="va">covariates.paths</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"dismo"</span><span class="op">)</span>, <span class="st">'ex'</span><span class="op">)</span>,
             pattern <span class="op">=</span> <span class="st">'grd$'</span>,
             full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Here covariates &lt;- stack(covariates.paths) </span>
<span class="co"># would have been enough for this specific case.</span>
<span class="va">is.factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"biome.grd"</span>, <span class="va">covariates.paths</span><span class="op">)</span>

<span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Prepare_covarStack.html">Prepare_covarStack</a></span><span class="op">(</span>cov.paths <span class="op">=</span> <span class="va">covariates.paths</span>, 
                              is.factor <span class="op">=</span> <span class="va">is.factor</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">covariates</span><span class="op">)</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 192, 186, 35712, 9  (nrow, ncol, ncell, nlayers)
## resolution : 0.5, 0.5  (x, y)
## extent     : -125, -32, -56, 40  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## names      : bio1, bio12, bio16, bio17, bio5, bio6, bio7, bio8, biome 
## min values :  -23,     0,     0,     0,   61, -212,   60,  -66,     1 
## max values :  289,  7682,  2458,  1496,  422,  242,  461,  323,    14</code></pre>
</div>
<div id="dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h2>
<p>A presence-absence dataset is created from dataset <code>bradypus</code> in library <code>dismo</code>. Dataset is transformed as <code>SpatialPointsDataFrame</code> and spatially joint with covariates. Here, all covariates rasters have originally the same projection, extent and resolution. Covariates information can then directly be extracted from the covariates RasterStack with <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract(covariates, data.sp)</a></code>. However, if your covariates Rasters have originally different projection, you should extract covariate information at your data positions from these original rasters. Indeed, reprojection of raster leads to modification and potential loss of the original information. It is recommended to reproject the point data stations to extract covariates from their projection of origin. Function <code>CovarExtract</code> does this task for you.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Presence data</span>
<span class="va">file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"dismo"</span><span class="op">)</span>, <span class="st">"ex/bradypus.csv"</span><span class="op">)</span>
<span class="va">bradypus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="va">file</span>,  header <span class="op">=</span> <span class="cn">TRUE</span>,  sep <span class="op">=</span> <span class="st">','</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="co"># Random-absence data</span>
<span class="va">randAbs</span> <span class="op">&lt;-</span> <span class="fu">dismo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dismo/man/randomPoints.html">randomPoints</a></span><span class="op">(</span><span class="va">covariates</span>, <span class="fl">400</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">randAbs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>
<span class="co"># Combine presence and absence</span>
<span class="va">data.sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">randAbs</span>, Obs <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">bradypus</span>, Obs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
              <span class="op">)</span>
<span class="co"># Transform data as SpatialPointsDataFrame</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">data.sp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">lon</span><span class="op">+</span><span class="va">lat</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html">proj4string</a></span><span class="op">(</span><span class="va">data.sp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"+proj=longlat +datum=WGS84"</span>

<span class="co"># Extract covariates, combine with dataset and set factor covariate</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CovarExtract.html">CovarExtract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data.sp</span>, cov.paths <span class="op">=</span> <span class="va">covariates.paths</span>,
                     is.factor <span class="op">=</span> <span class="va">is.factor</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">Obs</th>
<th align="right">bio1</th>
<th align="right">bio12</th>
<th align="right">bio16</th>
<th align="right">bio17</th>
<th align="right">bio5</th>
<th align="right">bio6</th>
<th align="right">bio7</th>
<th align="right">bio8</th>
<th align="left">biome</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">264</td>
<td align="right">3333</td>
<td align="right">1382</td>
<td align="right">325</td>
<td align="right">336</td>
<td align="right">204</td>
<td align="right">132</td>
<td align="right">256</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">265</td>
<td align="right">2269</td>
<td align="right">1008</td>
<td align="right">269</td>
<td align="right">326</td>
<td align="right">214</td>
<td align="right">113</td>
<td align="right">261</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">242</td>
<td align="right">217</td>
<td align="right">152</td>
<td align="right">4</td>
<td align="right">365</td>
<td align="right">104</td>
<td align="right">262</td>
<td align="right">307</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">262</td>
<td align="right">2212</td>
<td align="right">996</td>
<td align="right">190</td>
<td align="right">330</td>
<td align="right">211</td>
<td align="right">119</td>
<td align="right">258</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">262</td>
<td align="right">831</td>
<td align="right">328</td>
<td align="right">88</td>
<td align="right">323</td>
<td align="right">202</td>
<td align="right">121</td>
<td align="right">281</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">210</td>
<td align="right">1610</td>
<td align="right">477</td>
<td align="right">282</td>
<td align="right">322</td>
<td align="right">99</td>
<td align="right">223</td>
<td align="right">227</td>
<td align="left">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Show observations positions</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">covariates</span>, <span class="st">"bio1"</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">wrld_simpl</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">data</span>, 
     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Obs</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,
     pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Obs</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,
     add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-6-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="prepare-the-spatial-dataset-for-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-the-spatial-dataset-for-modelling" class="anchor"></a>Prepare the spatial dataset for modelling</h2>
<p>The first step only consists in changing observation column name to <code>dataY</code> and append factor column names with <code>factor_</code> for compatibility with following functions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data.prepared</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Prepare_dataset.html">Prepare_dataset</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">data</span>, var <span class="op">=</span> <span class="fl">1</span>, cov <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,
  datatype <span class="op">=</span> <span class="st">"PA"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<pre><code>## class       : SpatialPointsDataFrame 
## features    : 515 
## extent      : -122.25, -35.75, -54.75, 39.75  (xmin, xmax, ymin, ymax)
## crs         : +proj=longlat +datum=WGS84 +no_defs 
## variables   : 10
## names       : dataY, bio1, bio12, bio16, bio17, bio5, bio6, bio7, bio8, factor_biome 
## min values  :     0,   -4,     1,     1,     0,   67, -119,   78,  -49,            1 
## max values  :     1,  282,  7682,  2458,  1496,  415,  236,  447,  320,            9</code></pre>
<p>The random-absence dataset was deliberately created with a lot of stations. A high number of observations may lead to spatial auto-correlation that may interfere with modelling. We can simplify the dataset by resampling in a regular grid with a resolution partially reducing spatial-autocorrelation.<br>
Function <code>spatialcor_dist</code> helps define an optimal grid resolution for this purpose. There may be different depth of spatial auto-correlation in the dataset. Function <code>spatialcor_dist</code> allows comparing two levels using two maximum distances <code>max1</code> and <code>max2</code>. Two correlograms are calculated on the dataset based on these maximum values. A linear threshold model is fitted to find a possible threshold in correlation. This threshold value can be used for resampling in a regular grid having this value as a resolution.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">thd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialcor_dist.html">spatialcor_dist</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">data.prepared</span>, longlat <span class="op">=</span> <span class="op">!</span><span class="fu">is.projected</span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,
  binomial <span class="op">=</span> <span class="cn">TRUE</span>, saveWD <span class="op">=</span> <span class="va">tmpdir</span>,
  plot <span class="op">=</span> <span class="cn">TRUE</span>,
  figname <span class="op">=</span> <span class="st">"Correlogram"</span>
<span class="op">)</span></code></pre></div>
<p><img src="Correlogram.jpg" width="90%" style="display: block; margin: auto;"></p>
<p>We choose a resolution for resampling the data using proposition of <code>spatialcor_dist</code> function. Here, thresholds estimated are 1363km and 84km. The second value is used to build a regular grid, with which the spatial dataset is resampled. Function <code>RefRasterize</code> allows creating a grid with a defined resolution. Function <code>Prepare_dataset</code> is then re-run to create the new dataset passed through the grid. For all observations in the same grid cell, the function calculates the average spatial position, the average of all numeric covariates, the most frequent factor covariate, observation of presence if the species was present at least once in the cell (<em>the mean of observations when continuous data</em>). <code>data.new</code> output is a <code>SpatialPointsDataFrame</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create a regular grid from dataset</span>
<span class="va">RefRaster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RefRasterize.html">RefRasterize</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span>, res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">thd</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Use rectangular grid to resample dataset</span>
<span class="va">data.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Prepare_dataset.html">Prepare_dataset</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">data.prepared</span>, var <span class="op">=</span> <span class="fl">1</span>, cov <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,
  RefRaster <span class="op">=</span> <span class="va">RefRaster</span>, datatype <span class="op">=</span> <span class="st">"PA"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># Plot data.new</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">covariates</span>, <span class="st">"bio1"</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">wrld_simpl</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">sp</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">data.new</span>, 
     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span><span class="op">[</span><span class="va">data.new</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">dataY</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,
     pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">[</span><span class="va">data</span><span class="op">@</span><span class="va">data</span><span class="op">$</span><span class="va">Obs</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span>,
     add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-11-1.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="covariates-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#covariates-correlation" class="anchor"></a>Covariates correlation</h2>
<p>Due to identifiability issues, highly correlated environmental covariates should not be included in the same models. Correlations between all possible pairs of covariates are tested using the Spearman’s rho coefficient. Here, a rho value exceeding 0.7 considers covariates too correlated to be included in the same model. However, the following cross-validation procedure also guarantees too correlated covariates not to be included in the same models as gain in prediction may be low. Thus, the present covariates correlation selection step mainly allows the number of tested models to be reduced.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">corSpearman</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Param_corr.html">Param_corr</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">data.new</span>, rm <span class="op">=</span> <span class="fl">1</span>, thd <span class="op">=</span> <span class="fl">0.7</span>, visual <span class="op">=</span> <span class="cn">FALSE</span>,
  plot <span class="op">=</span> <span class="cn">TRUE</span>, img.size <span class="op">=</span> <span class="fl">8</span>, saveWD <span class="op">=</span> <span class="va">tmpdir</span><span class="op">)</span></code></pre></div>
<p><img src="Covariate_correlation_crop.png" width="50%" style="display: block; margin: auto;"></p>
</div>
<div id="find-the-best-combination-of-covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#find-the-best-combination-of-covariates" class="anchor"></a>Find the best combination of covariates</h2>
<p>Set options for presence-absence models. Have a look at options documentation <code><a href="../reference/modelselect_opt.html">?modelselect_opt</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/modelselect_opt.html">modelselect_opt</a></span><span class="op">(</span>RESET <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">modelselect_opt</span><span class="op">$</span><span class="va">Max_nb_Var</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">modelselect_opt</span><span class="op">$</span><span class="va">datatype</span> <span class="op">&lt;-</span> <span class="st">"PA"</span></code></pre></div>
<p>Procedure selects combination of covariates in each iteration from one covariate to the maximum defined (modelselect_opt(“Max_nb_Var”) = 3). This reproduces the procedure separately for all model types defined (modelselect_opt(“modeltypes”) = PAGLM, PAGLMns, PA). The output of <code>findBestModel</code> function is the link to a zipped file of all outputs saved in the <code>saveWD</code> directory. Messages in the console shows the steps of the iterative model selection procedure.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findBestModel.html">findBestModel</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data.new</span>, datatype <span class="op">=</span> <span class="st">"PA"</span>, 
                          corSpearman <span class="op">=</span> <span class="va">corSpearman</span>, 
                          saveWD <span class="op">=</span> <span class="va">tmpdir</span>, 
                          verbose <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="order-models-according-to-quality-of-prediction" class="section level2">
<h2 class="hasAnchor">
<a href="#order-models-according-to-quality-of-prediction" class="anchor"></a>Order models according to quality of prediction</h2>
<p>Model selection was realised separately for each distribution tested. The exact same k-fold cross-validation datasets have been used to keep the best model at each step of the iteration procedure. All indices of goodness of fit can thus be compared among the distributions tested with paired statistical tests. This allows to order all models tested. The best model and the following ones not statistically worse than the best one (one-sided <code>p-value &gt;= modelselect_opt$lim_pvalue_final</code>) are retained.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Order models and find the bests</span>
<span class="va">BestModels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ModelOrder.html">ModelOrder</a></span><span class="op">(</span>saveWD <span class="op">=</span> <span class="va">tmpdir</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This results in figures showing the distribution of the goodness of fit (here AUC) issued from cross-validation for each model. This allows to see that predictive power of some models is not very different than the best one. Coloured boxplots are those of AUC distribution not statistically different from the best one. Models are ranged by family chosen and number of covariates added during the forward stepwise procedure.</p>
<p><img src="Index_Error_on_crossV.png" width="90%" style="display: block; margin: auto;"></p>
<p>Two tables are available:</p>
<ul>
<li>“VeryBestModels_crossV” retains the best model and the ones not significantly worse than the first one.</li>
</ul>
<table class="table">
<thead><tr class="header">
<th align="right">Num</th>
<th align="left">model</th>
<th align="right">Mean_AUC_crossV</th>
<th align="right">Mean_RMSE_crossV</th>
<th align="right">AIC</th>
<th align="left">modeltype</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">42</td>
<td align="left">dataY ~ s(bio16,k=5) + s(bio5,k=5) + s(bio1,k=5)</td>
<td align="right">0.88</td>
<td align="right">0.32</td>
<td align="right">282</td>
<td align="left">PA</td>
</tr></tbody>
</table>
<ul>
<li>“BestForModeltypes” retains the first two best models of each “modeltype”.</li>
</ul>
<table class="table">
<colgroup>
<col width="3%">
<col width="52%">
<col width="14%">
<col width="15%">
<col width="3%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="right">Num</th>
<th align="left">model</th>
<th align="right">Mean_AUC_crossV</th>
<th align="right">Mean_RMSE_crossV</th>
<th align="right">AIC</th>
<th align="left">modeltype</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">42</td>
<td align="left">dataY ~ s(bio16,k=5) + s(bio5,k=5) + s(bio1,k=5)</td>
<td align="right">0.88</td>
<td align="right">0.32</td>
<td align="right">282</td>
<td align="left">PA</td>
</tr>
<tr class="even">
<td align="right">43</td>
<td align="left">dataY ~ s(bio6,k=5) + s(bio5,k=5) + s(bio12,k=5)</td>
<td align="right">0.86</td>
<td align="right">0.34</td>
<td align="right">302</td>
<td align="left">PA</td>
</tr>
<tr class="odd">
<td align="right">15</td>
<td align="left">dataY ~ bio12 + bio6 + poly(bio5,3)</td>
<td align="right">0.86</td>
<td align="right">0.34</td>
<td align="right">308</td>
<td align="left">PAGLM</td>
</tr>
<tr class="even">
<td align="right">16</td>
<td align="left">dataY ~ bio12 + bio6 + poly(bio5,2)</td>
<td align="right">0.86</td>
<td align="right">0.34</td>
<td align="right">310</td>
<td align="left">PAGLM</td>
</tr>
<tr class="odd">
<td align="right">27</td>
<td align="left">dataY ~ ns(bio7, df=2) + ns(bio5, df=3) + ns(bio8, df=2)</td>
<td align="right">0.84</td>
<td align="right">0.35</td>
<td align="right">320</td>
<td align="left">PAGLMns</td>
</tr>
<tr class="even">
<td align="right">23</td>
<td align="left">dataY ~ ns(bio7, df=2) + ns(bio5, df=3)</td>
<td align="right">0.84</td>
<td align="right">0.35</td>
<td align="right">320</td>
<td align="left">PAGLMns</td>
</tr>
</tbody>
</table>
<p>Covariates selected in all models not statistically different from the best one may be explored to choose the best model by expertise. Covariates are ordered based on occurrence in the models selected. You may want to choose between the best model and the model with most selected covariates.</p>
<p><img src="Help_for_model_Choice.png" width="90%" style="display: block; margin: auto;"></p>
</div>
<div id="predictions-of-the-best-model" class="section level2">
<h2 class="hasAnchor">
<a href="#predictions-of-the-best-model" class="anchor"></a>Predictions of the best model</h2>
<p>We can choose one model, the best one here, and create a set of figure outputs to explore what it is predicting. Figures are saved in <code>saveWD</code> and its compressed version (its path is the output of the function, here stored in <code>res.file</code>)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Num.Best</span> <span class="op">&lt;-</span> <span class="va">BestModels</span><span class="op">$</span><span class="va">VeryBestModels_crossV</span><span class="op">$</span><span class="va">Num</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">res.file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ModelResults.html">ModelResults</a></span><span class="op">(</span>saveWD <span class="op">=</span> <span class="va">tmpdir</span>, plot <span class="op">=</span> <span class="cn">TRUE</span>, 
                 Num <span class="op">=</span> <span class="va">Num.Best</span><span class="op">)</span></code></pre></div>
<p>In the case of a model with presence-absence, the outputs are the following.</p>
<ul>
<li><p>Analysis of variance. Deviance explained by each covariate when added sequentially in the order specified by the cross-validation procedure. “%Exp.Dev” stands for percentage of explained deviance. “AUC” is the mean AUC on the validation datasets as issued from the cross-validation procedure, “&gt;Diff” being the difference of cross-validation AUC with the previous step.<br><img src="Param_Exp_Deviance.png" width="100%" style="display: block; margin: auto;"></p></li>
<li><p>Marginal predictions by covariates. These are simplified marginal effects of each covariate in the range of observations. All covariates values except one have been fixed so that their combination give a prediction close to the mean of observations. These simplified marginals figures are to be read for their relative effect and not for their absolute prediction.<br><img src="CovForMeanPred_Marginals.png" width="75%" style="display: block; margin: auto;"></p></li>
<li>
<p>Comparison of predictions against observations and proposition of threshold values to separate presence from absences. The best threshold value is based on cross-validation outputs. This is the value closest to selectivity equals specificity.</p>
<ul>
<li>When the best model has been selected, it is used for prediction. All data are used to fit the model, predictions are made on the same dataset. For each observation, the model predicts a probability of presence between 0 and 1, although observations were 0 or 1. The figure is a “pirateplot” from package {yarrr}. It shows the distribution of predictions for the best model separating presence-absences observed.
<ul>
<li>The Bean plot is a smoothed density (inspired by Kampstra et al. (2008)).</li>
<li>The (Bar/Line Center) shows the mean of the distribution</li>
<li>The band represents an inference interval around the mean: Bayesian Highest Density Interval</li>
</ul>
</li>
<li>Other indices have been calculated during the cross-validation procedure.
<ul>
<li>The best THD is the best threshold value to separate presences from absences considering quality of prediction of the model. Indeed, if the cross-validation built 10 times 10-fold cross-validation models, then there are 100 validations. For each of the 100 model, the best threshold is the value on the ROC curves that equilibrates selectivity and sensitivity of the predictions. The best THD on the figure is the average of the 100 cross-validation thresholds. (Best THD close to 0.5 shows well-balanced dataset with trustwirthy predictions. lower (resp. higher) value show a desequilibrium towards absences (resp. presences) in the combination of covariates selected)</li>
<li>Similarly, MaxZero is the average of 100 cross-validation threshold calculated as the threshold below which 95% of absence are correctly classified as absences. (the closest to the best THD, the better)</li>
<li>Similarly, MaxUn is the average of 100 cross-validation threshold calculated as the threshold above which 95% of presences are correctly classified as presences. (the closest to the best THD, the better)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="Thresholds_for_prediction.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div id="species-distribution-mapping" class="section level2">
<h2 class="hasAnchor">
<a href="#species-distribution-mapping" class="anchor"></a>Species distribution mapping</h2>
<div id="probability-of-presence" class="section level3">
<h3 class="hasAnchor">
<a href="#probability-of-presence" class="anchor"></a>Probability of presence</h3>
<p>The outputs of the best model can be used to predict species distribution. The model selected is coupled with the raster of <code>covariates</code> to predict a probability of presence in each cell of the raster. Function <code>Map_predict</code> returns a <code>RasterStack</code> with these predictions.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Map_predict.html">Map_predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">covariates</span>, saveWD <span class="op">=</span> <span class="va">tmpdir</span>, Num <span class="op">=</span> <span class="va">Num.Best</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"SDM_Selection"</span>, <span class="st">"predr.tif"</span>, package <span class="op">=</span> <span class="st">"SDMSelect"</span><span class="op">)</span>
<span class="va">pred.r</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stack.html">stack</a></span><span class="op">(</span><span class="va">predr</span><span class="op">)</span>
<span class="va">predrNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"SDM_Selection"</span>, <span class="st">"predrNames.rds"</span>, package <span class="op">=</span> <span class="st">"SDMSelect"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="va">predrNames</span><span class="op">)</span></code></pre></div>
<p>The first output of interest is the first layer <code>resp.fit</code> of the <code>RasterStack</code>. Here, the predicted probability of presence. <em><code>SDMSelect</code> is provided with <code>gplot_data</code>, a modified version of <code><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">rasterVis::gplot</a></code> which allows to prepare a (part of) raster data for ggplot visualisation instead of visualizing it directly. Maybe useful in some situations.</em></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get partial raster data to plot in ggplot</span>
<span class="va">pred.r.gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gplot_data.html">gplot_data</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span>
<span class="co"># Plot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pred.r.gg</span>, <span class="va">variable</span> <span class="op">==</span> <span class="st">"resp.fit"</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span><span class="st">"Probability"</span>, low <span class="op">=</span> <span class="st">'yellow'</span>, high <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-28-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="uncertainties" class="section level3">
<h3 class="hasAnchor">
<a href="#uncertainties" class="anchor"></a>Uncertainties</h3>
<p>Function <code>Map_predict</code> also calculates different indices for the assessment of the uncertainty of prediction. For instance, minimum (quantile = 5%) and maximum (quantile = 95%) of possible predictions. (<em>This is based on quantiles predictions in the scale of the link function, then transformed in the scale of the response.</em>)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/addLayer.html">dropLayer</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Q5"</span>, <span class="st">"Q95"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span><span class="st">"Probability"</span>, low <span class="op">=</span> <span class="st">'yellow'</span>, high <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-29-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>The inter-quartile range (<code>IQR</code>) and the <code>IQR</code> divided by the median (<code>IQR.M</code>) give an idea of the absolute and relative uncertainty of the predictions. This is similar to standard deviation and coefficient of variation respectively but better here because predictions are not Gaussian shaped.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/addLayer.html">dropLayer</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IQR"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span><span class="st">"Absolute\nDispersion"</span>, low <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-30-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/addLayer.html">dropLayer</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"IQR.M"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span><span class="st">"Relative\nDispersion\nto median"</span>, low <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-31-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="separating-presence-from-absences" class="section level3">
<h3 class="hasAnchor">
<a href="#separating-presence-from-absences" class="anchor"></a>Separating presence from absences</h3>
<p>The best threshold value to separate presences from absences may not be <code>0.5</code> when the presence/absence data are not equilibrated among covariates selected. The best threshold value (<code>BestTHD</code>) is shown above in the plot comparing observations and predictions. We can retrieve this value with function <code>model_select</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_select.html">model_select</a></span><span class="op">(</span>
  saveWD <span class="op">=</span> <span class="va">tmpdir</span>,
  new.data <span class="op">=</span> <span class="va">data.new</span>,
  Num <span class="op">=</span> <span class="va">Num.Best</span><span class="op">)</span>
<span class="va">BestThd</span> <span class="op">&lt;-</span> <span class="va">model_selected</span><span class="op">$</span><span class="va">Seuil</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BestThdFile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"SDM_Selection"</span>, <span class="st">"BestThd.rds"</span>, package <span class="op">=</span> <span class="st">"SDMSelect"</span><span class="op">)</span>
<span class="va">BestThd</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">read_rds</a></span><span class="op">(</span><span class="va">BestThdFile</span><span class="op">)</span></code></pre></div>
<p>A better representation of the probabilities of presence should be with a double colour gradient, centred on the best threshold value (thd = 0.24).</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="st">"resp.fit"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span><span class="st">"Probability\nof\nPresence"</span>,
                       low <span class="op">=</span> <span class="st">'white'</span>, mid <span class="op">=</span> <span class="st">'yellow'</span>,  high <span class="op">=</span> <span class="st">'blue'</span>,
                       midpoint <span class="op">=</span> <span class="va">BestThd</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-34-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>Considering uncertainty of prediction, another output is the probability (%) to be over the best threshold value (thd = 0.24). This gives an idea of the risk to predict a presence, considering the uncertainty on the probability of presence and the best threshold value.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="st">"ProbaSup"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient2</a></span><span class="op">(</span><span class="st">"Probability\nto be over\nThreshold"</span>, 
                      low <span class="op">=</span> <span class="st">'white'</span>, mid <span class="op">=</span> <span class="st">'yellow'</span>, high <span class="op">=</span> <span class="st">'forestgreen'</span>,
                      midpoint <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-35-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="masks" class="section level3">
<h3 class="hasAnchor">
<a href="#masks" class="anchor"></a>Masks</h3>
<p>Finally, a model should not extrapolate out of the range of the data. The <code>Map_predict</code> function retrieves the range of covariates in the dataset used for modelling and create a raster mask for each covariate when out of the range of data observations. In the present example mask is not meaningful because of the absence data covering the entire area.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html">gplot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/addLayer.html">dropLayer</a></span><span class="op">(</span><span class="va">pred.r</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"mask"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pred.r</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span><span class="st">"mask"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"1"</span> <span class="op">=</span> <span class="st">"forestgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SDM_Selection_files/figure-html/unnamed-chunk-36-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sébastien Rochette.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
